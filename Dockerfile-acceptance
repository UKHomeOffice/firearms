FROM node:14-alpine@sha256:5c33bc6f021453ae2e393e6e20650a4df0a4737b1882d389f17069dc1933fdc5

RUN apk upgrade --no-cache
RUN addgroup -S app
RUN adduser -S app -G app -u 999 -h /app/
RUN chown -R app:app /app/

WORKDIR /test

COPY package.json package.json
COPY yarn.lock yarn.lock
COPY codecept.conf.js codecept.conf.js
COPY config.js config.js
COPY apps apps/

RUN yarn install --frozen-lockfile --production --ignore-optional

CMD npm run test:acceptance
